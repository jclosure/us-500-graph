(function(undefined){"use strict";function Supervisor(t,e){_root.URL=_root.URL||_root.webkitURL,e=e||{},this.sigInst=t,this.graph=this.sigInst.graph,this.ppn=10,this.ppe=3,this.config={},this.worker=null,this.shouldUseWorker=e.worker===!1?!1:!0&&webWorkers,this.workerUrl=e.workerUrl,this.runOnBackground=e.background?!0:!1,this.easing=e.easing,this.started=!1,this.running=!1,this.initWorker()}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,webWorkers="Worker"in _root,eventEmitter={};sigma.classes.dispatcher.extend(eventEmitter),Supervisor.prototype.makeBlob=function(t){var e;try{e=new Blob([t],{type:"application/javascript"})}catch(r){_root.BlobBuilder=_root.BlobBuilder||_root.WebKitBlobBuilder||_root.MozBlobBuilder,e=new BlobBuilder,e.append(t),e=e.getBlob()}return e},Supervisor.prototype.graphToByteArrays=function(){var t,e,r,s=this.graph.nodes(),n=this.graph.edges(),i=s.length*this.ppn,o=n.length*this.ppe,a={};for(this.nodesByteArray=new Float32Array(i),this.edgesByteArray=new Float32Array(o),t=e=0,r=s.length;r>t;t++)a[s[t].id]=e,this.nodesByteArray[e]=s[t].x,this.nodesByteArray[e+1]=s[t].y,this.nodesByteArray[e+2]=0,this.nodesByteArray[e+3]=0,this.nodesByteArray[e+4]=0,this.nodesByteArray[e+5]=0,this.nodesByteArray[e+6]=1+this.graph.degree(s[t].id),this.nodesByteArray[e+7]=1,this.nodesByteArray[e+8]=s[t].size,this.nodesByteArray[e+9]=s[t].fixed||0,e+=this.ppn;for(t=e=0,r=n.length;r>t;t++)this.edgesByteArray[e]=a[n[t].source],this.edgesByteArray[e+1]=a[n[t].target],this.edgesByteArray[e+2]=n[t].weight||0,e+=this.ppe},Supervisor.prototype.applyLayoutChanges=function(t){for(var e=this.graph.nodes(),r=0,s=0,n=this.nodesByteArray.length;n>s;s+=this.ppn)t?(e[r].fa2_x=this.nodesByteArray[s],e[r].fa2_y=this.nodesByteArray[s+1]):(e[r].x=this.nodesByteArray[s],e[r].y=this.nodesByteArray[s+1]),r++},Supervisor.prototype.sendByteArrayToWorker=function(t){var e={action:t||"loop",nodes:this.nodesByteArray.buffer},r=[this.nodesByteArray.buffer];"start"===t&&(e.config=this.config||{},e.edges=this.edgesByteArray.buffer,r.push(this.edgesByteArray.buffer)),this.shouldUseWorker?this.worker.postMessage(e,r):_root.postMessage(e,"*")},Supervisor.prototype.start=function(){this.running||(this.running=!0,this.started?this.sendByteArrayToWorker():(this.sendByteArrayToWorker("start"),this.started=!0,eventEmitter.dispatchEvent("start")))},Supervisor.prototype.stop=function(){this.running&&(this.running=!1,eventEmitter.dispatchEvent("stop"))},Supervisor.prototype.initWorker=function(){var _this=this,workerFn=sigma.layouts.getForceAtlas2Worker();if(this.shouldUseWorker){if(this.workerUrl)this.worker=new Worker(this.workerUrl);else{var blob=this.makeBlob(workerFn);this.worker=new Worker(URL.createObjectURL(blob))}this.worker.postMessage=this.worker.webkitPostMessage||this.worker.postMessage}else eval(workerFn);this.msgName=this.worker?"message":"newCoords",this.listener=function(t){_this.nodesByteArray=new Float32Array(t.data.nodes),_this.running&&(_this.applyLayoutChanges(_this.runOnBackground),_this.sendByteArrayToWorker(),_this.runOnBackground||_this.sigInst.refresh({skipIndexation:!0})),t.data.converged&&(_this.running=!1),_this.running||(_this.killWorker(),_this.runOnBackground&&_this.easing?(_this.applyLayoutChanges(!0),eventEmitter.dispatchEvent("interpolate"),sigma.plugins.animate(_this.sigInst,{x:"fa2_x",y:"fa2_y"},{easing:_this.easing,onComplete:function(){_this.sigInst.refresh(),eventEmitter.dispatchEvent("stop")}})):(_this.applyLayoutChanges(!1),_this.sigInst.refresh(),eventEmitter.dispatchEvent("stop")))},(this.worker||document).addEventListener(this.msgName,this.listener),this.graphToByteArrays(),_this.sigInst.bind("kill",function(){sigma.layouts.killForceAtlas2()})},Supervisor.prototype.killWorker=function(){this.worker?this.worker.terminate():(_root.postMessage({action:"kill"},"*"),document.removeEventListener(this.msgName,this.listener))},Supervisor.prototype.configure=function(t){if(this.config=t,this.started){var e={action:"config",config:this.config};this.shouldUseWorker?this.worker.postMessage(e):_root.postMessage(e,"*")}};var supervisor=null;sigma.layouts.startForceAtlas2=function(t,e){return supervisor?supervisor.running||(supervisor.killWorker(),supervisor.initWorker(),supervisor.started=!1):supervisor=new Supervisor(t,e),e&&supervisor.configure(e),supervisor.start(),eventEmitter},sigma.layouts.stopForceAtlas2=function(){return supervisor?(supervisor.stop(),supervisor):void 0},sigma.layouts.killForceAtlas2=function(){supervisor&&(supervisor.stop(),supervisor.killWorker(),supervisor=null,eventEmitter={},sigma.classes.dispatcher.extend(eventEmitter))},sigma.layouts.configForceAtlas2=function(t,e){return supervisor?supervisor.running||(supervisor.killWorker(),supervisor.initWorker(),supervisor.started=!1):supervisor=new Supervisor(t,e),supervisor.configure(e),eventEmitter},sigma.layouts.isForceAtlas2Running=function(){return!!supervisor&&supervisor.running}}).call(this),function(undefined){"use strict";function no_crush(t){var e,r,s,n=["x","y","dx","dy","old_dx","old_dy","mass","convergence","size","fixed"],i=["source","target","weight"],o=["node","centerX","centerY","size","nextSibling","firstChild","mass","massCenterX","massCenterY"];for(r=0,s=o.length;s>r;r++)e=new RegExp("rp\\(([^,]*), '"+o[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);for(r=0,s=n.length;s>r;r++)e=new RegExp("np\\(([^,]*), '"+n[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);for(r=0,s=i.length;s>r;r++)e=new RegExp("ep\\(([^,]*), '"+i[r]+"'\\)","g"),t=t.replace(e,0===r?"$1":"$1 + "+r);return t}function getWorkerFn(){var t=crush?crush(Worker.toString()):Worker.toString();return";("+t+").call(this);"}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layouts");var _root=this,inWebWorker=!("document"in _root),Worker=function(t){function e(){var t,e,r={},s=arguments.length;for(t=s-1;t>=0;t--)for(e in arguments[t])r[e]=arguments[t][e];return r}function r(t){var e;for(e in t)"hasOwnProperty"in t&&!t.hasOwnProperty(e)||delete t[e];return t}function s(t,e,r){r=r||{};a=t,h=e,u.nodesLength=a.length,u.edgesLength=h.length,n(r)}function n(t){u.settings=e(t,u.settings)}function i(){var t,e,r,s,n,i,o,p,d,l,c,f,y,v,w,k,m;for(r=0;r<u.nodesLength;r+=u.ppn)a[r+4]=a[r+2],a[r+5]=a[r+3],a[r+2]=0,a[r+3]=0;if(u.settings.outboundAttractionDistribution){for(d=0,r=0;r<u.nodesLength;r+=u.ppn)d+=a[r+6];d/=u.nodesLength}if(u.settings.barnesHutOptimize){var M,b,A=1/0,B=-(1/0),_=1/0,W=-(1/0);for(g=[],r=0;r<u.nodesLength;r+=u.ppn)A=Math.min(A,a[r]),B=Math.max(B,a[r]),_=Math.min(_,a[r+1]),W=Math.max(W,a[r+1]);for(g[0]=-1,g[1]=(A+B)/2,g[2]=(_+W)/2,g[3]=Math.max(B-A,W-_),g[4]=-1,g[5]=-1,g[6]=0,g[7]=0,g[8]=0,t=1,r=0;r<u.nodesLength;r+=u.ppn)for(e=0;;)if(g[e+5]>=0)M=a[r]<g[e+1]?a[r+1]<g[e+2]?g[e+5]:g[e+5]+u.ppr:a[r+1]<g[e+2]?g[e+5]+2*u.ppr:g[e+5]+3*u.ppr,g[e+7]=(g[e+7]*g[e+6]+a[r]*a[r+6])/(g[e+6]+a[r+6]),g[e+8]=(g[e+8]*g[e+6]+a[r+1]*a[r+6])/(g[e+6]+a[r+6]),g[e+6]+=a[r+6],e=M;else{if(g[e]<0){g[e]=r;break}if(g[e+5]=t*u.ppr,o=g[e+3]/2,p=g[e+5],g[p]=-1,g[p+1]=g[e+1]-o,g[p+2]=g[e+2]-o,g[p+3]=o,g[p+4]=p+u.ppr,g[p+5]=-1,g[p+6]=0,g[p+7]=0,g[p+8]=0,p+=u.ppr,g[p]=-1,g[p+1]=g[e+1]-o,g[p+2]=g[e+2]+o,g[p+3]=o,g[p+4]=p+u.ppr,g[p+5]=-1,g[p+6]=0,g[p+7]=0,g[p+8]=0,p+=u.ppr,g[p]=-1,g[p+1]=g[e+1]+o,g[p+2]=g[e+2]-o,g[p+3]=o,g[p+4]=p+u.ppr,g[p+5]=-1,g[p+6]=0,g[p+7]=0,g[p+8]=0,p+=u.ppr,g[p]=-1,g[p+1]=g[e+1]+o,g[p+2]=g[e+2]+o,g[p+3]=o,g[p+4]=g[e+4],g[p+5]=-1,g[p+6]=0,g[p+7]=0,g[p+8]=0,t+=4,M=a[g[e]]<g[e+1]?a[g[e]+1]<g[e+2]?g[e+5]:g[e+5]+u.ppr:a[g[e]+1]<g[e+2]?g[e+5]+2*u.ppr:g[e+5]+3*u.ppr,g[e+6]=a[g[e]+6],g[e+7]=a[g[e]],g[e+8]=a[g[e]+1],g[M]=g[e],g[e]=-1,b=a[r]<g[e+1]?a[r+1]<g[e+2]?g[e+5]:g[e+5]+u.ppr:a[r+1]<g[e+2]?g[e+5]+2*u.ppr:g[e+5]+3*u.ppr,M!==b){g[b]=r;break}e=M}}if(u.settings.barnesHutOptimize)for(l=u.settings.scalingRatio,r=0;r<u.nodesLength;r+=u.ppn)for(e=0;;)if(g[e+5]>=0){if(k=Math.sqrt(Math.pow(a[r]-g[e+7],2)+Math.pow(a[r+1]-g[e+8],2)),2*g[e+3]/k<u.settings.barnesHutTheta){if(c=a[r]-g[e+7],f=a[r+1]-g[e+8],u.settings.adjustSize?k>0?(m=l*a[r+6]*g[e+6]/k/k,a[r+2]+=c*m,a[r+3]+=f*m):0>k&&(m=-l*a[r+6]*g[e+6]/k,a[r+2]+=c*m,a[r+3]+=f*m):k>0&&(m=l*a[r+6]*g[e+6]/k/k,a[r+2]+=c*m,a[r+3]+=f*m),g[e+4]<0)break;e=g[e+4];continue}e=g[e+5]}else{if(g[e]>=0&&g[e]!==r&&(c=a[r]-a[g[e]],f=a[r+1]-a[g[e]+1],k=Math.sqrt(c*c+f*f),u.settings.adjustSize?k>0?(m=l*a[r+6]*a[g[e]+6]/k/k,a[r+2]+=c*m,a[r+3]+=f*m):0>k&&(m=-l*a[r+6]*a[g[e]+6]/k,a[r+2]+=c*m,a[r+3]+=f*m):k>0&&(m=l*a[r+6]*a[g[e]+6]/k/k,a[r+2]+=c*m,a[r+3]+=f*m)),g[e+4]<0)break;e=g[e+4]}else for(l=u.settings.scalingRatio,s=0;s<u.nodesLength;s+=u.ppn)for(n=0;s>n;n+=u.ppn)c=a[s]-a[n],f=a[s+1]-a[n+1],u.settings.adjustSize?(k=Math.sqrt(c*c+f*f)-a[s+8]-a[n+8],k>0?(m=l*a[s+6]*a[n+6]/k/k,a[s+2]+=c*m,a[s+3]+=f*m,a[n+2]+=c*m,a[n+3]+=f*m):0>k&&(m=100*l*a[s+6]*a[n+6],a[s+2]+=c*m,a[s+3]+=f*m,a[n+2]-=c*m,a[n+3]-=f*m)):(k=Math.sqrt(c*c+f*f),k>0&&(m=l*a[s+6]*a[n+6]/k/k,a[s+2]+=c*m,a[s+3]+=f*m,a[n+2]-=c*m,a[n+3]-=f*m));for(p=u.settings.gravity/u.settings.scalingRatio,l=u.settings.scalingRatio,r=0;r<u.nodesLength;r+=u.ppn)m=0,c=a[r],f=a[r+1],k=Math.sqrt(Math.pow(c,2)+Math.pow(f,2)),u.settings.strongGravityMode?k>0&&(m=l*a[r+6]*p):k>0&&(m=l*a[r+6]*p/k),a[r+2]-=c*m,a[r+3]-=f*m;for(l=1*(u.settings.outboundAttractionDistribution?d:1),i=0;i<u.edgesLength;i+=u.ppe)s=h[i],n=h[i+1],o=h[i+2],w=Math.pow(o,u.settings.edgeWeightInfluence),c=a[s]-a[n],f=a[s+1]-a[n+1],u.settings.adjustSizes?(k=Math.sqrt(Math.pow(c,2)+Math.pow(f,2)-a[s+8]-a[n+8]),u.settings.linLogMode?u.settings.outboundAttractionDistribution?k>0&&(m=-l*w*Math.log(1+k)/k/a[s+6]):k>0&&(m=-l*w*Math.log(1+k)/k):u.settings.outboundAttractionDistribution?k>0&&(m=-l*w/a[s+6]):k>0&&(m=-l*w)):(k=Math.sqrt(Math.pow(c,2)+Math.pow(f,2)),u.settings.linLogMode?u.settings.outboundAttractionDistribution?k>0&&(m=-l*w*Math.log(1+k)/k/a[s+6]):k>0&&(m=-l*w*Math.log(1+k)/k):u.settings.outboundAttractionDistribution?(k=1,m=-l*w/a[s+6]):(k=1,m=-l*w)),k>0&&(a[s+2]+=c*m,a[s+3]+=f*m,a[n+2]-=c*m,a[n+3]-=f*m);var E,L,x,F,S=0;if(u.settings.adjustSizes)for(r=0;r<u.nodesLength;r+=u.ppn)a[r+9]||(E=Math.sqrt(Math.pow(a[r+2],2)+Math.pow(a[r+3],2)),E>u.maxForce&&(a[r+2]=a[r+2]*u.maxForce/E,a[r+3]=a[r+3]*u.maxForce/E),L=a[r+6]*Math.sqrt((a[r+4]-a[r+2])*(a[r+4]-a[r+2])+(a[r+5]-a[r+3])*(a[r+5]-a[r+3])),x=Math.sqrt((a[r+4]+a[r+2])*(a[r+4]+a[r+2])+(a[r+5]+a[r+3])*(a[r+5]+a[r+3]))/2,F=.1*Math.log(1+x)/(1+Math.sqrt(L)),y=a[r],v=a[r+1],a[r]=a[r]+a[r+2]*(F/u.settings.slowDown),a[r+1]=a[r+1]+a[r+3]*(F/u.settings.slowDown),c=a[r],f=a[r+1],k=Math.sqrt(Math.pow(c-y,2)+Math.pow(f-v,2)),S+=k);else for(r=0;r<u.nodesLength;r+=u.ppn)a[r+9]||(L=a[r+6]*Math.sqrt((a[r+4]-a[r+2])*(a[r+4]-a[r+2])+(a[r+5]-a[r+3])*(a[r+5]-a[r+3])),x=Math.sqrt((a[r+4]+a[r+2])*(a[r+4]+a[r+2])+(a[r+5]+a[r+3])*(a[r+5]+a[r+3]))/2,F=a[r+7]*Math.log(1+x)/(1+Math.sqrt(L)),a[r+7]=Math.min(1,Math.sqrt(F*(Math.pow(a[r+2],2)+Math.pow(a[r+3],2))/(1+Math.sqrt(L)))),y=a[r],v=a[r+1],a[r]=a[r]+a[r+2]*(F/u.settings.slowDown),a[r+1]=a[r+1]+a[r+3]*(F/u.settings.slowDown),c=a[r],f=a[r+1],k=Math.sqrt(Math.pow(c-y,2)+Math.pow(f-v,2)),S+=k);u.iterations++,u.settings.autoStop&&(u.converged=u.iterations>u.settings.maxIterations||S/u.nodesLength<u.settings.avgDistanceThreshold)}function o(t){for(var e=0;t>e;e++)i();p()}var a,h,g,p,u={ppn:10,ppe:3,ppr:9,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:1,iterationsPerRender:1,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!1}};p="undefined"!=typeof window&&window.document?function(){var t;document.createEvent?(t=document.createEvent("Event"),t.initEvent("newCoords",!0,!1)):(t=document.createEventObject(),t.eventType="newCoords"),t.eventName="newCoords",t.data={nodes:a.buffer,converged:u.converged},requestAnimationFrame(function(){document.dispatchEvent(t)})}:function(){self.postMessage({nodes:a.buffer,converged:u.converged},[a.buffer])};var d=function(t){switch(t.data.action){case"start":s(new Float32Array(t.data.nodes),new Float32Array(t.data.edges),t.data.config),o(u.settings.startingIterations);break;case"loop":a=new Float32Array(t.data.nodes),o(u.settings.iterationsPerRender);break;case"config":n(t.data.config);break;case"kill":r(u),a=null,h=null,g=null,self.removeEventListener("message",d)}};self.addEventListener("message",d)},crush=null;if(inWebWorker)eval(getWorkerFn());else{if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.layouts.getForceAtlas2Worker=getWorkerFn}}.call(this);