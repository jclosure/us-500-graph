(function(e){"use strict";var t=.7,i=.2,r=[],a=function(e,t,i){r.push({name:e,drawShape:t,drawBorder:i})},n=function(){return r},o=function(e){return function(i,r,a,n,o,s){s.fillStyle=o,s.beginPath(),e(i,r,a,n*t,s),s.closePath(),s.fill()}},s=function(e){return function(r,a,n,o,s,l){l.strokeStyle=s,l.lineWidth=o*t*i,l.beginPath(),e(r,a,n,o*t,l),l.closePath(),l.stroke()}},l=function(e,t,i,r,a){var n=45*Math.PI/180;a.moveTo(t+r*Math.sin(n),i-r*Math.cos(n));for(var o=1;4>o;o++)a.lineTo(t+Math.sin(n+2*Math.PI*o/4)*r,i-Math.cos(n+2*Math.PI*o/4)*r)};a("square",o(l),s(l));var c=function(e,t,i,r,a){a.arc(t,i,r,0,2*Math.PI,!0)};a("circle",o(c),s(c));var u=function(e,t,i,r,a){a.moveTo(t-r,i),a.lineTo(t,i-r),a.lineTo(t+r,i),a.lineTo(t,i+r)};a("diamond",o(u),s(u));var p=function(e,t,i,r,a){var n=e.cross&&e.cross.lineWeight||5;a.moveTo(t-r,i-n),a.lineTo(t-r,i+n),a.lineTo(t-n,i+n),a.lineTo(t-n,i+r),a.lineTo(t+n,i+r),a.lineTo(t+n,i+n),a.lineTo(t+r,i+n),a.lineTo(t+r,i-n),a.lineTo(t+n,i-n),a.lineTo(t+n,i-r),a.lineTo(t-n,i-r),a.lineTo(t-n,i-n)};a("cross",o(p),s(p));var h=function(e,t,i,r,a){var n=e.equilateral&&e.equilateral.numPoints||5,o=e.equilateral&&e.equilateral.rotate||0,s=r;o+=Math.PI/n,a.moveTo(t+s*Math.sin(o),i-s*Math.cos(o));for(var l=1;n>l;l++)a.lineTo(t+Math.sin(o+2*Math.PI*l/n)*s,i-Math.cos(o+2*Math.PI*l/n)*s)};a("equilateral",o(h),s(h));var d=function(e,t,i,r,a){var n=e.star&&e.star.numPoints||5,o=e.star&&e.star.innerRatio||.5,s=r,l=r*o,c=Math.PI/n;a.moveTo(t,i-r);for(var u=0;n>u;u++)a.lineTo(t+Math.sin(c+2*Math.PI*u/n)*l,i-Math.cos(c+2*Math.PI*u/n)*l),a.lineTo(t+Math.sin(2*Math.PI*(u+1)/n)*s,i-Math.cos(2*Math.PI*(u+1)/n)*s)};a("star",o(d),s(d));var m=function(e,t,i,r,a,n){n.fillStyle="yellow",n.beginPath(),n.arc(t,i,r,1.25*Math.PI,0,!1),n.arc(t,i,r,0,.75*Math.PI,!1),n.lineTo(t,i),n.closePath(),n.fill(),n.fillStyle="white",n.strokeStyle="black",n.beginPath(),n.arc(t+r/3,i-r/3,r/4,0,2*Math.PI,!1),n.closePath(),n.fill(),n.stroke(),n.fillStyle="black",n.beginPath(),n.arc(t+4*r/9,i-r/3,r/8,0,2*Math.PI,!1),n.closePath(),n.fill()};a("pacman",m,null),this.ShapeLibrary={enumerate:n,version:"0.2"}}).call(this),function(e){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";if("undefined"==typeof ShapeLibrary)throw"ShapeLibrary is not declared";sigma.utils.pkg("sigma.canvas.nodes"),sigma.utils.pkg("sigma.svg.nodes");var t={},i=function(e,i,r,a,n,o){if(e.image&&e.image.url){var s=e.image.url,l=e.image.h||1,c=e.image.w||1,u=e.image.scale||1,p=e.image.clip||1,h=t[s];h||(h=document.createElement("IMG"),h.setAttribute("crossOrigin",o),h.src=s,h.onload=function(){window.dispatchEvent(new Event("resize"))},t[s]=h);var d=l>c?c/l:1,m=c>l?l/c:1,f=a*u;n.save(),n.beginPath(),n.arc(i,r,a*p,0,2*Math.PI,!0),n.closePath(),n.clip(),n.drawImage(h,i+Math.sin(-0.7855)*f*d,r-Math.cos(-0.7855)*f*m,f*d*2*Math.sin(-0.7855)*-1,f*m*2*Math.cos(-0.7855)),n.restore()}},r=function(e,t,i,r,a){var n=e.icon.font||"Arial",o=e.icon.color||"#F00",s=e.icon.content||"?",l=(e.icon.x||.5,e.icon.y||.5,r),c=.7;"number"==typeof e.icon.scale&&(c=Math.abs(Math.max(.01,e.icon.scale)));var u=Math.round(c*l);a.fillStyle=o,a.font=""+u+"px "+n,a.textAlign="center",a.textBaseline="middle",a.fillText(s,t,i)},a=function(e,t,i){if(sigInst&&e.image&&e.image.url){var r=document.createElementNS(i("xmlns"),"circle"),a=document.createElementNS(i("xmlns"),"clipPath"),n=i("classPrefix")+"-clip-path-"+e.id,o=document.createElementNS(i("xmlns"),"defs"),s=document.createElementNS(i("xmlns"),"image");e.image.url;a.setAttributeNS(null,"id",n),a.appendChild(r),o.appendChild(a);var l=/MSIE [5-9]/.test(navigator.userAgent)?"":document.location.href;l=l.split("#")[0],s.setAttributeNS(null,"class",i("classPrefix")+"-node-image"),s.setAttributeNS(null,"clip-path","url("+l+"#"+n+")"),s.setAttributeNS(null,"pointer-events","none"),s.setAttributeNS("http://www.w3.org/1999/xlink","href",e.image.url),t.appendChild(o),t.appendChild(s)}},n=function(e,t,n){sigma.canvas.nodes[e]=function(e,a,o){var s=(arguments,o("prefix")||""),l=e[s+"size"],c=e.color||o("defaultNodeColor"),u=o("imgCrossOrigin")||"anonymous",p=e.borderColor||c,h=e[s+"x"],d=e[s+"y"];a.save(),t&&t(e,h,d,l,c,a),n&&n(e,h,d,l,p,a),i(e,h,d,l,a,u),"undefined"!=typeof e.icon&&r(e,h,d,l,a),i(e,h,d,l,a),a.restore()},sigma.svg.nodes[e]={create:function(e,t){var i=document.createElementNS(t("xmlns"),"g"),r=document.createElementNS(t("xmlns"),"circle");return i.setAttributeNS(null,"class",t("classPrefix")+"-node-group"),i.setAttributeNS(null,"data-node-id",e.id),r.setAttributeNS(null,"data-node-id",e.id),r.setAttributeNS(null,"class",t("classPrefix")+"-node"),r.setAttributeNS(null,"fill",e.color||t("defaultNodeColor")),i.appendChild(r),a(e,i,t),i},update:function(e,t,i){for(var r=i("classPrefix"),a=e.image.clip||1,n=e.image.h||1,o=e.image.w||1,s=i("prefix")||"",l=e.image.scale||1,c=e[s+"size"],u=e[s+"x"],p=e[s+"y"],h=l*c,d=n>o?o/n:1,m=o>n?n/o:1,f=0,g=t.childNodes;f<g.length;f++){var x=g[f].getAttribute("class");switch(x){case r+"-node":g[f].setAttributeNS(null,"cx",u),g[f].setAttributeNS(null,"cy",p),g[f].setAttributeNS(null,"r",c),i("freeStyle")||g[f].setAttributeNS(null,"fill",e.color||i("defaultNodeColor"));break;case r+"-node-image":g[f].setAttributeNS(null,"x",u+Math.sin(-0.7855)*h*d),g[f].setAttributeNS(null,"y",p-Math.cos(-0.7855)*h*m),g[f].setAttributeNS(null,"width",h*d*2*Math.sin(-0.7855)*-1),g[f].setAttributeNS(null,"height",h*m*2*Math.cos(-0.7855));break;default:var _=g[f].firstChild;if(null!=_){var v=r+"-clip-path-"+e.id;_.getAttribute("id")===v&&(_.firstChild.setAttributeNS(null,"cx",u),_.firstChild.setAttributeNS(null,"cy",p),_.firstChild.setAttributeNS(null,"r",a*c))}}}t.style.display=""}}};ShapeLibrary.enumerate().forEach(function(e){n(e.name,e.drawShape,e.drawBorder)}),this.CustomShapes={version:"0.2"}}.call(this),function(){"use strict";sigma.utils.pkg("sigma.webgl.nodes"),sigma.webgl.nodes.def={POINTS:3,ATTRIBUTES:12,addNode:function(e,t,i,r,a){var n=this,o=e.color||a("defaultNodeColor"),s=a("imgCrossOrigin")||"anonymous",l=sigma.utils.floatColor(o);"undefined"==typeof n.spriteSheet&&n.createSpriteSheet(a);var c=-1,u=.7,p=999,h=1,d=1,m=1,f=0;switch(e.type||"circle"){case"circle":case"disc":case"disk":m=1,p=999,u=1;break;case"square":m=0,p=4,u=.7,"undefined"!=typeof e.square&&"number"==typeof e.square.rotate&&(f=e.square.rotate);break;case"diamond":m=0,p=4,u=.7,f=45*Math.PI/180,"undefined"!=typeof e.diamond&&"number"==typeof e.diamond.rotate&&(f=e.diamond.rotate);break;case"triangle":m=0,p=3,u=.5,f=Math.PI,"undefined"!=typeof e.triangle&&"number"==typeof e.triangle.rotate&&(f=e.triangle.rotate);break;case"star":m=1,u=.7,p=5,"undefined"!=typeof e.star&&("number"==typeof e.star.numPoints&&(p=e.star.numPoints),"number"==typeof e.star.rotate&&(f=e.star.rotate));break;case"seastar":m=2,u=.5,p=5,"undefined"!=typeof e.seastar&&("number"==typeof e.seastar.numPoints&&(p=e.seastar.numPoints),"number"==typeof e.seastar.rotate&&(f=e.seastar.rotate));break;case"equilateral":m=0,p=7,u=.7,f=0,"undefined"!=typeof e.equilateral&&("number"==typeof e.equilateral.numPoints&&(p=e.equilateral.numPoints),"number"==typeof e.equilateral.rotate&&(f=e.equilateral.rotate));break;case"hexagon":m=0,p=6,u=.7,"undefined"!=typeof e.hexagon&&"number"==typeof e.hexagon.rotate&&(f=e.hexagon.rotate);break;case"polygon":m=1,p=5,u=.5,f=0,"undefined"!=typeof e.polygon&&("string"==typeof e.polygon.type&&(m="convex"==e.polygon.type?1:0),"number"==typeof e.polygon.angles&&(p=Math.round(Math.max(3,Math.min(8,e.polygon.angles)))),"number"==typeof e.polygon.scale&&(u=e.polygon.scale||(m?.5:.7)),"number"==typeof e.polygon.rotate&&(f=e.polygon.rotate));break;case"cross":m=0,p=9,u=.1,"undefined"!=typeof e.cross&&("number"==typeof e.cross.lineWeight&&(u=Math.max(.1,Math.min(.5,.1*e.cross.lineWeight))),"number"==typeof e.rotate&&(f=e.cross.rotate))}if("undefined"!=typeof e.image){var g=e.image.url||"";g.length>0&&(c=n.getImage(g,s),h=e.image.w||1,d=e.image.h||1)}if("undefined"!=typeof e.icon){var x="Arial";"string"==typeof e.icon.font&&(x=e.icon.font);var _="";"string"==typeof e.icon.content&&(_=e.icon.content);var v=.7;"number"==typeof e.icon.scale&&(v=.5*Math.abs(Math.max(.01,e.icon.scale)));var y=e.icon.color||o,S=e.color||o,T=.5,b=.5;"number"==typeof e.icon.x&&(T=e.icon.x),"number"==typeof e.icon.y&&(b=e.icon.y),c=n.getText(x,S,y,v,T,b,_)}t[i++]=e[r+"x"],t[i++]=e[r+"y"],t[i++]=e[r+"size"],t[i++]=l,t[i++]=0,t[i++]=m,t[i++]=p,t[i++]=u,t[i++]=f,t[i++]=c,t[i++]=h,t[i++]=d,t[i++]=e[r+"x"],t[i++]=e[r+"y"],t[i++]=e[r+"size"],t[i++]=l,t[i++]=2*Math.PI/3,t[i++]=m,t[i++]=p,t[i++]=u,t[i++]=f,t[i++]=c,t[i++]=h,t[i++]=d,t[i++]=e[r+"x"],t[i++]=e[r+"y"],t[i++]=e[r+"size"],t[i++]=l,t[i++]=4*Math.PI/3,t[i++]=m,t[i++]=p,t[i++]=u,t[i++]=f,t[i++]=c,t[i++]=h,t[i++]=d},render:function(e,t,i,r){var a,n=this,o=arguments;"undefined"==typeof n.spriteSheet&&n.createSpriteSheet();var s=e.getAttribLocation(t,"a_position"),l=e.getAttribLocation(t,"a_size"),c=e.getAttribLocation(t,"a_color"),u=e.getAttribLocation(t,"a_angle"),p=e.getAttribLocation(t,"a_image"),h=e.getAttribLocation(t,"a_shape"),d=e.getUniformLocation(t,"u_resolution"),m=e.getUniformLocation(t,"u_matrix"),f=e.getUniformLocation(t,"u_ratio"),g=e.getUniformLocation(t,"u_scale"),x=e.getUniformLocation(t,"u_sprite_dim"),_=e.getUniformLocation(t,"u_texture_dim");e.getUniformLocation(t,"u_sampler");a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,i,e.DYNAMIC_DRAW),e.uniform2f(d,r.width,r.height),e.uniform1f(f,1/Math.pow(r.ratio,r.settings("nodesPowRatio"))),e.uniform1f(g,r.scalingRatio),e.uniformMatrix3fv(m,!1,r.matrix),e.uniform2f(x,n.spriteSheet.spriteWidth,n.spriteSheet.spriteHeight),e.uniform2f(_,n.spriteSheet.maxWidth,n.spriteSheet.maxHeight),e.enableVertexAttribArray(s),e.enableVertexAttribArray(l),e.enableVertexAttribArray(c),e.enableVertexAttribArray(u),e.enableVertexAttribArray(h),e.enableVertexAttribArray(p),e.vertexAttribPointer(s,2,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0),e.vertexAttribPointer(l,1,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8),e.vertexAttribPointer(c,1,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,12),e.vertexAttribPointer(u,1,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,16),e.vertexAttribPointer(h,4,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,20),e.vertexAttribPointer(p,3,e.FLOAT,!1,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,36),"undefined"==typeof n.texture&&(n.texture=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.spriteSheet.canvas),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.generateMipmap(e.TEXTURE_2D),setTimeout(function(){n.render.apply(n,o)},1e3)),"undefined"!=typeof n.texture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n.texture),n.updateNeeded&&(n.updateNeeded=!1,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n.spriteSheet.canvas)),e.uniform1i(e.getUniformLocation(t,"u_sampler"),0)),e.drawArrays(e.TRIANGLES,r.start||0,r.count||i.length/this.ATTRIBUTES)},initProgram:function(e){var t,i,r;return t=sigma.utils.loadShader(e,["attribute vec2 a_position;","attribute float a_size;","attribute float a_color;","attribute float a_angle;","attribute vec4 a_shape;","attribute vec3 a_image;","uniform vec2 u_resolution;","uniform float u_ratio;","uniform float u_scale;","uniform mat3 u_matrix;","uniform vec2 u_sprite_dim;","uniform vec2 u_texture_dim;","varying vec4 shape;","varying highp vec4 v_sprite;","varying vec4 color;","varying vec2 center;","varying float radius;","varying vec3 image;","void main() {","radius = a_size * u_ratio;","vec2 position = (u_matrix * vec3(a_position, 1)).xy;","center = position * u_scale;","center = vec2(center.x, u_scale * u_resolution.y - center.y);","position = position +","2.0 * radius * vec2(cos(a_angle), sin(a_angle));","position = (position / u_resolution * 2.0 - 1.0) * vec2(1, -1);","radius = radius * u_scale;","shape = a_shape;","image = a_image;","highp vec2 sp = ","vec2(mod((a_image.s * u_sprite_dim.x), u_texture_dim.x),","floor((a_image.s * u_sprite_dim.x) / u_texture_dim.y) * u_sprite_dim.y);","sp = vec2(sp.x + (u_sprite_dim.x * 0.5),"," sp.y + (u_sprite_dim.y * 0.5));","v_sprite = vec4(","sp.x / u_texture_dim.x,","sp.y / u_texture_dim.y,","u_sprite_dim.x / u_texture_dim.x,","- u_sprite_dim.y / u_texture_dim.y",");","gl_Position = vec4(position, 0, 1);","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),e.VERTEX_SHADER),i=sigma.utils.loadShader(e,["#ifdef GL_ES","precision mediump float;","#endif","#define PI_2 6.283185307179586","#define MAX_ANGLES 8","varying vec4 shape;","varying highp vec4 v_sprite;","varying vec4 color;","varying vec2 center;","varying float radius;","varying vec3 image;","uniform sampler2D u_sampler;","void main(void) {","int angles = int(shape.t);","int convex = int(shape.s);","vec2 m = gl_FragCoord.xy - center;","vec2 p = m.xy/radius;","float theta = atan(p.y,p.x);","vec4 color0 = vec4(0.0, 0.0, 0.0, 0.0);","vec4 color1 = (image.s >= 0.0) ?"," texture2D(u_sampler, ","vec2(","(v_sprite.s + v_sprite.p * p.x * 0.5 * image.t),","(v_sprite.t + v_sprite.q * p.y * 0.5 * image.p)","))"," : color",";","mat2 shapeRot = mat2(cos(shape.q),sin(shape.q),-sin(shape.q),cos(shape.q));","p = p * shapeRot;","if (angles > 9) {","gl_FragColor = ","((radius - sqrt(m.x * m.x + m.y * m.y)) > 0.0)","? color1 : color0;","} else if (angles > 8){","gl_FragColor = (","(abs(p.x) > 0.0 && abs(p.x) < (1.0 - sin(shape.p)) && abs(p.y) < shape.p)","|| (abs(p.y) > 0.0 && abs(p.y) < (1.0 - sin(shape.p)) && abs(p.x) < shape.p)",") ? color1 : color0;","} else {","float scale = (convex > 0) ? shape.p * 0.5 : shape.p;","float angle = PI_2 / shape.t;","mat2 t = mat2(cos(angle),sin(angle),-sin(angle),cos(angle));","int q = 0;","for (int i=0;i<MAX_ANGLES;i++) {","if (i >= angles) break;","if (p.y < scale) q++;","p *= t;","}","gl_FragColor =","((convex > 0)","? (q > angles - (angles - 1) / 2)",": (q > angles - 1))","? color1 : color0;","}","}"].join("\n"),e.FRAGMENT_SHADER),r=sigma.utils.loadProgram(e,[t,i])},createSpriteSheet:function(e){var t=this,i={maxWidth:e("spriteSheetResolution")||2048,maxHeight:e("spriteSheetResolution")||2048,maxSprites:e("spriteSheetMaxSprites")||256},r=i.maxWidth/Math.sqrt(i.maxSprites),a=i.maxHeight/Math.sqrt(i.maxSprites),n=document.createElement("canvas");n.width=i.maxWidth,n.height=i.maxHeight;n.getContext("2d");t.spriteSheet={canvas:n,maxWidth:i.maxWidth,maxHeight:i.maxHeight,maxSprites:i.maxSprite,spriteWidth:r,spriteHeight:a,currentIndex:1,urlToIndex:{}}},getText:function(e,t,i,r,a,n,o){var s=this,l=Math.round(r*s.spriteSheet.spriteHeight),c=a*s.spriteSheet.spriteWidth,u=n*s.spriteSheet.spriteHeight,p=e+":"+t+":"+i+":"+l+":"+o+":"+c+":"+u;if(p in s.spriteSheet.urlToIndex)return s.spriteSheet.urlToIndex[p];var h=s.spriteSheet.currentIndex;s.spriteSheet.currentIndex+=1,s.spriteSheet.urlToIndex[p]=h;var d=h*s.spriteSheet.spriteWidth%s.spriteSheet.maxWidth,m=Math.floor(h*s.spriteSheet.spriteWidth/s.spriteSheet.maxWidth)*s.spriteSheet.spriteHeight,f=s.spriteSheet.canvas.getContext("2d");return f.beginPath(),f.rect(d,m,s.spriteSheet.spriteWidth,s.spriteSheet.spriteHeight),f.fillStyle=t,f.fill(),f.beginPath(),f.fillStyle=i,f.font=""+l+"px "+e,f.textAlign="center",f.textBaseline="middle",f.fillText(o,d+c,m+u),s.updateNeeded=!0,h},getImage:function(e,t){var i=this,r=i.spriteSheet.canvas.getContext("2d");if(e.length<1)return-1;if(e in i.spriteSheet.urlToIndex)return i.spriteSheet.urlToIndex[e];var a=i.spriteSheet.currentIndex;if(a>i.spriteSheet.maxSprites)return-1;i.spriteSheet.currentIndex+=1,i.spriteSheet.urlToIndex[e]=a;var n=new Image;return n.setAttribute("crossOrigin",t),n.onload=function(){var e=a*i.spriteSheet.spriteWidth%i.spriteSheet.maxWidth,t=Math.floor(a*i.spriteSheet.spriteWidth/i.spriteSheet.maxWidth)*i.spriteSheet.spriteHeight;r.drawImage(n,0,0,n.width,n.height,e,t,i.spriteSheet.spriteWidth,i.spriteSheet.spriteHeight),i.updateNeeded=!0},n.src=e,a}}}();