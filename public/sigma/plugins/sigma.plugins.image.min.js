(function(){"use strict";function a(a,b,c){var d=document.createElement("a");d.setAttribute("href",a),d.setAttribute("download",c||"graph."+b);var e=document.createEvent("MouseEvent");e.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e),d.remove()}function b(a,b,c){var d=Math.min(c/a,c/b);return{width:a*d,height:b*d}}function c(a,b,c){var d;return d=sigma.utils.getBoundaries(a.graph,b.camera.readPrefix),d.minX/=c.zoomRatio,d.minY/=c.zoomRatio,d.maxX/=c.zoomRatio,d.maxY/=c.zoomRatio,d}function d(a,d,e){var f,g=e.margin||0,h={width:d.width,height:d.height};return e.clips||e.size?e.size&&e.size>=1&&(h=b(d.width,d.height,e.size)):(f=c(a,d,e),h={width:f.maxX-f.minX+2*f.sizeMax,height:f.maxY-f.minY+2*f.sizeMax}),h.width+=g,h.height+=g,h}function e(b,c,e){if(e=e||{},e.format&&!(e.format in g))throw Error('sigma.renderers.image: unsupported format "'+e.format+'".');var f=d(b,c,e);e.clip||this.clone(b,e,f);var h=this.draw(c,e,f),i=h.toDataURL(g[e.format||"png"]);return e.download&&a(i,e.format||"png",e.filename),i}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var f,g,h,i;f=["scene","edges","nodes","labels"],g={png:"image/png",jpg:"image/jpeg",gif:"image/gif",tiff:"image/tiff"},e.prototype.clone=function(a,b,c){b.tmpContainer=b.tmpContainer||"image-container";var d=document.getElementById(b.tmpContainer);d||(d=document.createElement("div"),d.id=b.tmpContainer,document.body.appendChild(d)),d.setAttribute("style","width:"+c.width+"px;height:"+Math.round(c.height)+"px;");var e=a.addRenderer({container:document.getElementById(b.tmpContainer),type:"canvas",settings:{batchEdgesDrawing:!0,drawLabels:!!b.labels}});e.camera.ratio=b.zoomRatio>0?b.zoomRatio:1;var g=e instanceof sigma.renderers.webgl,j=!1,k=[];h=document.createElement("canvas"),i=h.getContext("2d"),a.refresh(),f.forEach(function(a){if(e.contexts[a]&&(b.labels!==!1||"labels"!==a)){var d=e.domElements[a]||e.domElements.scene,f=e.contexts[a];j||(h.width=c.width,h.height=c.height,g&&f instanceof WebGLRenderingContext&&(h.width*=.5,h.height*=.5),j=!0),f instanceof WebGLRenderingContext?i.drawImage(d,0,0,d.width/2,d.height/2):i.drawImage(d,0,0),~k.indexOf(f)||k.push(f)}}),k=[],a.killRenderer(e),d.remove()},e.prototype.draw=function(a,c,d){(!c.size||c.size<1)&&(c.size=window.innerWidth);var e=a instanceof sigma.renderers.webgl,g=!1,i=[],j=document.createElement("canvas"),k=j.getContext("2d");return f.forEach(function(f){if(a.contexts[f]&&(c.labels!==!1||"labels"!==f)){var l=a.domElements[f]||a.domElements.scene,m=a.contexts[f];if(!~i.indexOf(m)){if(!g){var n,o;c.clip?(n=l.width,o=l.height,d=b(n,o,c.size)):(n=h.width,o=h.height),j.width=d.width,j.height=d.height,!e&&!m instanceof WebGLRenderingContext&&(j.width*=2,j.height*=2),g=!0,c.background&&(k.rect(0,0,j.width,j.height),k.fillStyle=c.background,k.fill())}c.clip?k.drawImage(l,0,0,j.width,j.height):k.drawImage(h,0,0,j.width,j.height),i.push(m)}}}),i=[],j};var j=null;sigma.plugins.image=function(a,b,c){return sigma.plugins.killImage(),j||(j=new e(a,b,c)),j},sigma.plugins.killImage=function(){j instanceof e&&(j=null,h=null,i=null)}}).call(this);
//# sourceMappingURL=sigma.plugins.image.min.js.map